package me.neptune.impl.module.exploit.raytracebypass;

import me.neptune.api.event.listener.ModuleListener;
import me.neptune.asm.mixins.IPlayerMoveC2SPacket;
import net.minecraft.network.packet.Packet;
import net.minecraft.network.packet.c2s.play.PlayerInteractBlockC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;

public class ListenerSend extends ModuleListener<RaytraceBypass, Packet<?>> {

    public ListenerSend(RaytraceBypass module) {
        super(module, Packet.class);
    }

    @Override
    public void call(Packet<?> event) {
        if(event instanceof PlayerInteractBlockC2SPacket && module.timer.passed(250)) {
            if(mc.world.isSpaceEmpty(mc.player.getBoundingBox().stretch(0, .15, 0))) {
                module.pitch = -75;
                module.timer.reset();
            }
        }

        if(event instanceof PlayerMoveC2SPacket movePacket && module.pitch != -91) {
            ((IPlayerMoveC2SPacket) movePacket).setPitch(module.pitch);
            module.pitch = -91;
        }
    }
}
